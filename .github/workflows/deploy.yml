name: Deploy Hundir la Flota

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:

      - name: Checkout del código
        uses: actions/checkout@v3

      - name: Configurar Docker Buildx
        uses: docker/setup-buildx-action@v2

      - name: Construir Backend
        run: |
          docker build -t backend ./backend

      - name: Construir Frontend
        run: |
          docker build -t frontend ./frontend

      - name: Iniciar Backend
        run: |
          docker run -d -p 5000:5000 --name backend_container backend

      - name: Iniciar Frontend
        run: |
          docker run -d -p 80:80 --name frontend_container frontend

      - name: Instalar Ngrok
        run: |
          sudo apt update -y
          sudo apt install -y unzip wget
          wget https://bin.equinox.io/c/4VmDzA7iaHb/ngrok-stable-linux-amd64.zip
          unzip ngrok-stable-linux-amd64.zip

      - name: Autenticar Ngrok
        run: |
          ./ngrok authtoken ${{ secrets.NGROK_AUTHTOKEN }}

      - name: Iniciar túnel Ngrok
        run: |
          ./ngrok http 80 --log=stdout > ngrok.log &
          sleep 5
          echo "=== URL del túnel ==="
          curl -s http://localhost:4040/api/tunnels

      - name: Mantener contenedores vivos
        run: |
